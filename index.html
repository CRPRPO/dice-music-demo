<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dice Music Prototype</title>
  <style>
    body {
      margin: 0;
      background: #111;
      color: white;
      font-family: sans-serif;
      text-align: center;
    }
    .music-block {
      width: 100px;
      height: 100px;
      background: #4caf50;
      position: absolute;
      top: 150px;
      left: 50%;
      transform: translateX(-50%);
      border-radius: 10px;
      box-shadow: 0 0 10px #4caf50;
      cursor: grab;
      z-index: 1000;
    }
    .drop-zone {
      width: 150px;
      height: 150px;
      background: #555;
      border: 2px dashed white;
      position: absolute;
      top: 350px;
      left: 50%;
      transform: translateX(-50%);
      border-radius: 15px;
    }
  </style>
</head>
<body>
  <h1>Dice Music Prototype</h1>
  <div class="music-block" id="musicBlock">üéµ</div>
  <div class="drop-zone" id="dropZone"></div>

  <script src="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.min.js"></script>
  <script>
    const musicBlock = document.getElementById('musicBlock');
    const dropZone = document.getElementById('dropZone');

    let isDragging = false;
    let offsetX, offsetY;

    function startDrag(e) {
      isDragging = true;
      const clientX = e.touches ? e.touches[0].pageX : e.pageX;
      const clientY = e.touches ? e.touches[0].pageY : e.pageY;
      offsetX = clientX - musicBlock.offsetLeft;
      offsetY = clientY - musicBlock.offsetTop;
      musicBlock.style.cursor = 'grabbing';
      musicBlock.style.zIndex = 1000;
    }

    function dragMove(e) {
      if (!isDragging) return;
      e.preventDefault(); // Èò≤Ê≠¢ÊâãÊ©üÊªæÂãïÁï´Èù¢
      const clientX = e.touches ? e.touches[0].pageX : e.pageX;
      const clientY = e.touches ? e.touches[0].pageY : e.pageY;
      musicBlock.style.left = `${clientX - offsetX}px`;
      musicBlock.style.top = `${clientY - offsetY}px`;
    }

    function endDrag(e) {
      isDragging = false;
      musicBlock.style.cursor = 'grab';

      const blockRect = musicBlock.getBoundingClientRect();
      const zoneRect = dropZone.getBoundingClientRect();

      const isInZone = !(
        blockRect.right < zoneRect.left ||
        blockRect.left > zoneRect.right ||
        blockRect.bottom < zoneRect.top ||
        blockRect.top > zoneRect.bottom
      );

      if (isInZone) {
        const synth = new Tone.Synth().toDestination();
        Tone.start();
        synth.triggerAttackRelease("C4", "8n");

        dropZone.style.borderColor = "#4caf50";
        setTimeout(() => dropZone.style.borderColor = "white", 300);
      }
    }

    // ÊªëÈº†‰∫ã‰ª∂
    musicBlock.addEventListener('mousedown', startDrag);
    document.addEventListener('mousemove', dragMove);
    document.addEventListener('mouseup', endDrag);

    // Ëß∏Êéß‰∫ã‰ª∂ÔºàÊâãÊ©üÔºâ
    musicBlock.addEventListener('touchstart', startDrag);
    document.addEventListener('touchmove', dragMove, { passive: false });
    document.addEventListener('touchend', endDrag);
  </script>
</body>
</html>
